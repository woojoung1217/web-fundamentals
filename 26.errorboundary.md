# React Error Boundary와 비동기 에러

## 왜 Error Boundary가 비동기 에러를 잡지 못할까?

React의 Error Boundary는 **비동기 코드에서 발생한 오류를 잡을 수 없습니다**. 그 이유는 비동기 에러가 렌더링 시점의 콜스택이 모두 비워진 후에 발생하기 때문입니다.

## 동작 원리

### Error Boundary가 잡는 에러

- **동기적인 렌더링 과정** 중에 발생한 오류
- React는 컴포넌트를 렌더링할 때 하나의 연속된 콜스택 흐름 안에서 작업을 처리
- Error Boundary도 이 렌더링 흐름 중에 실행되어 동기 오류를 감지

### Error Boundary가 잡지 못하는 에러

- **비동기 작업**에서 발생한 오류 (Promise, setTimeout, 이벤트 핸들러 등)
- 렌더링이 끝난 후, 콜스택이 비워진 시점에 발생
- Error Boundary는 해당 시점에 더 이상 존재하지 않음

## 비동기 에러 처리 방법

### 1. try-catch로 직접 처리

```js
const fetchData = async () => {
  try {
    const response = await fetch("/api/data");
    const data = await response.json();
    setData(data);
  } catch (error) {
    console.error("비동기 에러:", error);
    // 에러 상태 관리
  }
};
```

### 2. setState를 이용한 에러 상태 관리

```js
const [error, setError] = useState(null);

const handleAsyncOperation = async () => {
  try {
    await someAsyncOperation();
  } catch (err) {
    setError(err); // 컴포넌트 상태로 에러 관리
  }
};
```

### 3. 동기 에러로 변환하여 Error Boundary 활용

```js
const [shouldThrow, setShouldThrow] = useState(false);

useEffect(() => {
  fetchData().catch(() => {
    setShouldThrow(true); // 상태 변경으로 동기 에러 발생
  });
}, []);

if (shouldThrow) {
  throw new Error("비동기 에러가 동기 에러로 변환됨");
}
```

## 핵심 포인트

- Error Boundary는 **렌더링 중에만** 동작
- 비동기 에러는 **별도 처리** 필요
- 상태 관리나 동기 에러 변환을 통해 Error Boundary 활용 가능
